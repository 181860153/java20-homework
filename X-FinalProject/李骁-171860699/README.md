# 葫芦娃大战妖精双人游戏

## 游戏简介

玩法参考：鹿顶计

核心玩法：

1. 对战双方各自代表葫芦娃阵营和妖精阵营。

2. 游戏有跑道区，手牌区。手牌分2种：人物卡和道具卡

3. 跑道区有3条跑道，玩家从手牌区抽人物卡拖到跑道上，人物自动向对面阵营走去，路上战斗-扣血-死亡。人物走到一条线尽头会给对方指挥官扣血，血扣完或游戏时间到，分出胜负

人物卡

葫芦娃阵营

1. 穿山甲

2. 大娃

3. 火娃

4. 水娃

5. 爷爷


妖精阵营

1. 小喽啰

2. 持盾小喽啰

3. 蛇妖

4. 蝎子精


道具卡

1. 重置：重置手牌

2. 加一：使对方现有卡牌区的花费+1

3. 减一：使自己现有卡牌区的花费-1

4. 滚石：消灭一条线上的敌我单位

5. 冰冻：冰冻一条线上的敌我单位，3s

6. 闪电：消灭一条线上的第一个敌方单位


## 代码设计

### Main类

启动游戏，监听端口，广播包，建立通信，确定是服务端还是客户端

### 人物类 Creature

含力量值（对应体型），血量，位置，移速，攻速，伤害，技能，外观，在场上/卡牌区/卡池里的状态位，所属阵营

提供移动，碰撞检测，攻击，掉血，死亡，施法方法

* 葫芦娃阵营 Huluwa

穿山甲 Chuanshanjia：力量1，血量3，碰撞敌人后开始普通攻击

大娃 Dawa：力量3，血量3，碰撞敌人后开始普通攻击

火娃 Huowa：力量2，血量2，距离3格内开始喷火，造成范围伤害

水娃 Shuiwa：力量2，血量2，距离3格内开始喷水，减慢敌人的移动速度

爷爷 Yeye：力量1，血量1，鼓舞葫芦娃，但可以让前面的葫芦娃力量+1


* 妖精类 Yaojing

小喽啰 Louluo：力量1，血量3，碰撞敌人后开始普通攻击

持盾小喽啰 Chidunlouluo：力量1，血量5，碰撞敌人后开始普通攻击

蝎子精 Xiezijing：力量4，血量6，距离5格内会用尾巴刺一个敌人

蛇精 Shejing：力量3，血量3，距离5格内会定住一个敌人，持续2s

### 卡牌类 Card

含价格，图片

* 人物卡 CreatureCard：绑定一个人物类

* 道具卡 PropCard：实现一种道具效果方法

### 跑道类 Runway

含多个人物

### 卡牌区类 CardField

含有现有卡牌列表，现有金钱数；提供购买卡牌并指定跑道、自动补充卡牌方法

### 跑道区类 RunwayField

含上中下三条跑道，控制跑道位置

### 指挥官类

血量，游戏时间，胜利姿态，指挥姿态

### 画布类？

### 音效类？

### 网络通信类？

## 类间关系

跑道类，含有多个人物

人物提供走动，攻击，掉血，死亡方法

卡牌区类，含有五张卡牌，当前金钱数量。提供购买卡牌并指定跑道、补充卡牌方法

卡牌类

人物卡类，绑定一个具体人物类，提供一张卡牌图片，价格增减方法

道具卡类，提供一种效果方法，提供一张卡牌图片，价格增减方法

## 

鼠标点击卡牌
* 如果是人物卡或者可以释放的卡，那么卡牌跟住鼠标
    * 下一次点击的位置如果在跑道上，就放在那个跑道上，生成人物开始跑/卡生效
    * 否则，放回原位
* 如果是直接生效卡（+1，-1）那就直接生效

***
12.24

把人物拼力量的补上
设当前速度和初始速度
新拖上去的葫芦娃是初始速度
如果贴在一起的葫芦娃力量不足，所有贴在一起的葫芦娃速度取小负数
力量相等，速度取0
如果力量够了，速度取正
贴在一起的葫芦娃时刻互相比较

具体：
假设所有生物初始移速一样，都是1
M2 M1 M0 Y0 Y1 Y2
只有队头的生物（们）会被对方力量怼


1. M0和Y0未接触
相安无事，大家各自往前走

2. M0和Y0接触
从M0开始检测M0身后与M0贴着的队伍有哪些人，设这些人为Ms

从Y0开始检测Y0贴着的有哪些人，设为Ys

对比Ms力量之和Mpower，Ys力量之和Ypower

如果Mpower > Ypower，Ms中的人速度变为1，Ys中的人速度变为-1
如果相等，大家都变0

*接触怎么判断：算(x,y) 和figuresize，
abs(x1-x2) <= s1+s2就算接触

BUG：N:1的时候，力量弱的一方被顶回来时候速度会慢，不知道为啥

我估计是这样，顶回来的时候，强的一方贴合不紧密，导致一会1:1，一会N:1，所以弱的一方不断在0和-1之间跳，导致出问题
解决的话就是让强的贴合近一点？no，很难实现，简单的办法是如果队头和对面队头碰了，发现对面队头速度为负，那就直接跳过

***

D牌时崩溃，要加线程锁，而且反向遍历删除，由于增删卡牌只有在主线程使用，所以arraylist没事，但考虑选卡时候的效率，要不改成linkedlist？

***
12.25
跑道上的人物缩小一点

下一步实现多元的卡牌，完善金币自动增长和价格，D牌时刷新5张随机卡，实现道具卡

道具卡，需要提供一个Prop接口

道具卡

- 1. 重置：重置手牌，没用，改D牌了

2. 加一：使对方现有卡牌区的花费+1，这得发个包，给cardField添加cardsCostPlusN方法

3. 减一：使自己现有卡牌区的花费-1，给cardField添加cardsCostMinusN方法

4. 滚石：消灭一条线上的敌我单位，得发包，给runway添加removeAllCreature方法

5. 冰冻：冰冻一条线上的敌方单位，3s，得发包，给runway添加frozenEnemyCreature方法，给creature添加frozen方法，设置冰冻计时器启动，在update中，如果处于冰冻状态，速度归0，计时器减少，计时器结束时速度恢复（到原来状态）（恢复到默认速度可能会有问题？）

6. 闪电：消灭一条线上的第一个敌方单位，得发包，给runway添加removeEnemyHead方法，和对应removeMyHead线程安全问题

BUG： D牌的时候会卡一下，估计D的也得作为单独线程，放入cardField，其实并不是，是因为D牌算法写的太慢了，考虑换LinkedList试试
是fillcards太慢，是createRandomCard太慢

***

12.26

再下一步实现多元的人物，多实现几个人物，和图片